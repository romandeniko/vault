---
created: 2025-10-09T15:47:00
status:
links:
  - "[[Базы данных]]"
  - "[[SQL]]"
  - "[[Запросы SQL]]"
---
```sql
SELECT buy.buy_id, title, price, buy_book.amount
FROM
    client INNER JOIN buy ON client.client_id = buy.client_id
    INNER JOIN buy_book ON buy.buy_id = buy_book.buy_id
    INNER JOIN book ON buy_book.book_id = book.book_id
WHERE client.name_client = 'Баранов Павел'
ORDER BY buy_id ASC, title ASC;
```

```sql
SELECT name_author, title, COUNT(buy_book.buy_id) AS Количество
FROM author
     RIGHT JOIN book ON author.author_id = book.author_id
     LEFT JOIN buy_book ON book.book_id = buy_book.book_id
GROUP BY name_author, title
ORDER BY name_author ASC, title ASC;
```

```sql
SELECT name_city, COUNT(buy.client_id) AS Количество
FROM city
     INNER JOIN client ON city.city_id = client.city_id
     INNER JOIN buy ON client.client_id = buy.client_id
GROUP BY name_city
ORDER by Количество DESC, name_city ASC;
```

```sql
SELECT buy.buy_id, name_client, SUM(buy_book.amount * book.price) AS Стоимость
FROM book
     INNER JOIN buy_book ON book.book_id = buy_book.book_id
     INNER JOIN buy ON buy_book.buy_id = buy.buy_id
     INNER JOIN client ON buy.client_id = client.client_id
GROUP BY buy.buy_id
ORDER BY buy.buy_id ASC;
```

```sql
SELECT buy_step.buy_id, name_step
FROM buy_step 
     INNER JOIN step ON buy_step.step_id = step.step_id
WHERE date_step_beg IS NOT NULL AND date_step_end IS NULL
ORDER BY buy_step.buy_id ASC;
```

```sql
SELECT buy.buy_id, DATEDIFF(date_step_end, date_step_beg) AS Количество_дней, 
(
    SELECT IF(DATEDIFF(date_step_end, date_step_beg) - days_delivery > 0, DATEDIFF(date_step_end, date_step_beg) - days_delivery, 0)
) AS Опоздание
FROM city
     INNER JOIN client ON city.city_id = client.city_id
     INNER JOIN buy ON client.client_id = buy.client_id
     INNER JOIN buy_step ON buy.buy_id = buy_step.buy_id
     INNER JOIN step ON buy_step.step_id = step.step_id
WHERE name_step = 'Транспортировка' and date_step_end IS NOT NULL
ORDER BY buy.buy_id ASC;
```

```sql
SELECT DISTINCT(name_client)
FROM client
     INNER JOIN buy ON client.client_id = buy.client_id
     INNER JOIN buy_book ON buy.buy_id = buy_book.buy_id
     INNER JOIN book ON buy_book.book_id = book.book_id
     INNER JOIN author ON book.author_id = author.author_id
WHERE name_author = 'Достоевский Ф.М.'
ORDER BY name_client ASC;
```

```sql
SELECT popular.name_genre, popular.Количество
FROM (
    SELECT name_genre, SUM(buy_book.amount) AS Количество
    FROM genre
    INNER JOIN book ON genre.genre_id = book.genre_id
    INNER JOIN buy_book ON book.book_id = buy_book.book_id
GROUP BY name_genre
)popular
INNER JOIN (
SELECT name_genre, SUM(buy_book.amount) AS Количество
FROM genre
     INNER JOIN book ON genre.genre_id = book.genre_id
     INNER JOIN buy_book ON book.book_id = buy_book.book_id
GROUP BY name_genre
LIMIT 1
) max_genre ON popular.Количество = max_genre.Количество;
```





















