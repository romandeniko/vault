---
created: 2025-09-28T16:30:00
status:
links:
  - "[[Базы данных]]"
  - "[[SQL]]"
  - "[[Запросы SQL]]"
  - "[[Создание таблицы с внешними ключами]]"
---
Новая таблица может быть создана на основе данных из другой таблицы. Для этого используется запрос `SELECT`, результирующая таблица которого и будет новой таблицей базы данных. При этом имена столбцов запроса становятся именами столбцов новой таблицы. Запрос на создание новой таблицы имеет вид:

```sql
CREATE TABLE имя_таблицы AS
SELECT ...
```

**Пример**

Создать таблицу заказ (`ordering`), куда включить авторов и названия тех книг, количество экземпляров которых в таблице `book` меньше 4. Для всех книг указать одинаковое количество экземпляров 5.

_Запрос:_

```sql
CREATE TABLE ordering AS
SELECT author, title, 5 AS amount
FROM book
WHERE amount < 4;

SELECT * FROM ordering;
```

_Результат:_

```sql
Affected rows: 2
Query result:
+------------------+--------------------+--------+
| author           | title              | amount |
+------------------+--------------------+--------+
| Булгаков М.А.    | Мастер и Маргарита | 5      |
| Достоевский Ф.М. | Братья Карамазовы  | 5      |
+------------------+--------------------+--------+
```

При создании таблицы можно использовать вложенные запросы как после `SELECT`, так и после `WHERE`.

**Пример**

Создать таблицу заказ (`ordering`), куда включить авторов и названия тех книг, количество экземпляров которых в таблице `book` меньше 4. Для всех книг указать одинаковое значение - среднее количество экземпляров книг в таблице `book`.

_Запрос:_

```sql
CREATE TABLE ordering AS
SELECT author, title, 
   (
    SELECT ROUND(AVG(amount)) 
    FROM book
   ) AS amount
FROM book
WHERE amount < 4;

SELECT * FROM ordering;
```

_Результат:_

```sql
Affected rows: 2
Query result:
+------------------+--------------------+--------+
| author           | title              | amount |
+------------------+--------------------+--------+
| Булгаков М.А.    | Мастер и Маргарита | 7      |
| Достоевский Ф.М. | Братья Карамазовы  | 7      |
+------------------+--------------------+--------+
```

```sql
CREATE TABLE ordering AS
SELECT author, title,
    (SELECT ROUND(AVG(amount))
     FROM book
    ) AS amount
FROM book
WHERE amount < (
    SELECT ROUND(AVG(amount))
    FROM book
);

SELECT * FROM ordering;
```

```sql
CREATE TABLE back_payment AS
SELECT name, number_plate, violation, sum_fine, date_violation
FROM fine
WHERE date_payment IS NULL;

SELECT * FROM back_payment;
```

```sql
CREATE TABLE buy_pay AS
SELECT title, name_author, price, amount, Стоимость
FROM (
    SELECT title, name_author, price, buy_book.amount, price*buy_book.amount AS Стоимость
    FROM author
    INNER JOIN book ON author.author_id = book.author_id
    INNER JOIN buy_book ON book.book_id = buy_book.book_id
    WHERE buy_id = 5
    GROUP BY title, name_author, price, buy_book.amount
    ORDER BY title ASC) result;

SELECT * FROM buy_pay;
```

```sql
CREATE TABLE buy_pay AS
SELECT buy_id, Количество, Итого
FROM (
    SELECT buy_book.buy_id, SUM(buy_book.amount) AS Количество, SUM(price*buy_book.amount) AS Итого
    FROM author
    INNER JOIN book ON author.author_id = book.author_id
    INNER JOIN buy_book ON book.book_id = buy_book.book_id
    WHERE buy_id = 5
    GROUP BY buy_book.buy_id) result;

SELECT * FROM buy_pay;
```

























