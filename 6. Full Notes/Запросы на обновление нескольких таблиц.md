---
created: 2025-09-28T15:46:00
status:
links:
  - "[[Базы данных]]"
  - "[[Запросы SQL]]"
  - "[[SQL]]"
---
В запросах на обновление можно использовать несколько таблиц, но тогда

- для столбцов, имеющих одинаковые имена, необходимо указывать имя таблицы, к которой они относятся, например, `book.price` – столбец `price` из таблицы `book`, **`supply.price`** – столбец `price` из таблицы `supply`;
- все таблицы, используемые в запросе, нужно перечислить после ключевого слова `UPDATE`;
- в запросе обязательно условие `WHERE`, в котором указывается условие при котором обновляются данные.

**Пример**

Если в таблице `supply`  есть те же книги, что и в таблице `book`, добавлять эти книги в таблицу `book` не имеет смысла. Необходимо увеличить их количество на значение столбца `amount`таблицы `supply`.

_Запрос:_

```sql
UPDATE book, supply 
SET book.amount = book.amount + supply.amount
WHERE book.title = supply.title AND book.author = supply.author;

SELECT * FROM book;
```

_Результат:_

```sql
Affected rows: 2
Query result:
+---------+-----------------------+------------------+--------+--------+
| book_id | title                 | author           | price  | amount |
+---------+-----------------------+------------------+--------+--------+
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 12     |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 13     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |
| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |
+---------+-----------------------+------------------+--------+--------+
```

В этом запросе увеличилось количество двух книг: «Белая гвардия», которая в `**supply**` имеет ту же цену, и «Идиот», но цена этой книги в таблицах `**book**` и **`supply`** отличается. Для этой книги нужно пересчитать цену.

```sql
UPDATE book, supply
SET book.amount = book.amount + supply.amount,
    book.price = (book.price + supply.price)/2
WHERE book.title = supply.title;

SELECT * FROM book;
```

```sql
CREATE TABLE violators AS
SELECT name, number_plate, violation
FROM fine
GROUP BY name, number_plate, violation
HAVING COUNT(violation) >= 2;

UPDATE fine f, violators v
SET f.sum_fine = f.sum_fine * 2
WHERE f.number_plate = v.number_plate AND f.date_payment IS NULL;

SELECT * FROM fine;
```

```sql
UPDATE fine f, payment p
SET f.date_payment = p.date_payment
WHERE f.date_violation = p.date_violation AND f.date_payment IS NULL;

UPDATE fine f, payment p
SET f.sum_fine = f.sum_fine/2
WHERE f.date_violation = p.date_violation AND f.date_payment = p.date_payment AND DATEDIFF(f.date_payment, f.date_violation) <= 20;

SELECT * FROM fine;
```




























